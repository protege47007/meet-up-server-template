#!/usr/bin/env node
// module dependencies
const http = require("http")
const config = require("../server/config")[process.env.NODE_ENV || "development"]
const app = require("../server/app")(config)

// helper functions

function normalizePort(val){
    const port = parseInt(val, 10)

    if(Number.isNaN(port)){
        // named pipe
        return val
    }

    if(port >= 0){
        // port number
        return port
    }

    return false
}

// get port from environment and store in express
const port = normalizePort(process.env.PORT || '3000')
app.set("port", port)

db.connect(config.database.dsn).then( () => {
    
})

const server = http.createServer(app)

server.listen(port)
server.on("listening", () => {
    const addr = server.address()
    const bind = typeof addr === "string"
})